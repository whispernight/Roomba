<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="es">
<!--#include virtual="head_es.html" -->

      <div id="Content">

<h2>Funcionamiento</h2>
<h3>XMPP</h3>
<p>El XMPP (Extensible Messaging and Presence Protocol) es un protocolo orientado a la mensajería que lleva más de 10 años funcionando en la red. Es tan robusto que es la elección de Google y Facebook para implementar sus chats (entre muchos otros). Está estandarizado, los detalles de su implentación son abiertos y está basado en XML, de modo que ha sido la perfecta elección para usarlo en Roomba.</p>
<p>La librería que hemos utilizado para llevar a cabo nuestro proyecto utiliza la especificación XEP-0124, que establece una conexión permanente y bidireccional entre cliente y servidor a través de HTTP. Mediante mensajes XML los dos extremos inician una conexión que mantienen viva mediante constantes mensajes Keep Alive. Se crean dos conexiones para que la comunicación sea bidireccional y poder hacer envíos push, de modo que no haya que hacer espera activa para el envío de mensajes. Esto se conoce como HTTP-BIND y aumenta muchísimo la eficiencia del ancho de banda en la comunicación con respecto a versiones iniciales del protocolo XMPP (por aquel entonces conocido como Jabber).</p>
<p>El protocolo es sensible a errores de conexión del mismo modo que lo haría el protocolo TCP. La implementación del protocolo en nuestra práctica viene dada con la librería Strophe, escrita en JavaScript, que se encarga de proporcionar una interfaz cómoda de envío y recepción de mensajes (stanzas).</p>
<p>Los detalles de esta especificación concreta del protocolo pueden encontrarse en http://xmpp.org/extensions/xep-0124.html. El esquema de los mensajes XML es el siguiente</p>
<pre class="prettyprint"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">'1.0'</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">'UTF-8'</span><span class="pun">?&gt;</span><span class="pln"><br><br></span><span class="tag">&lt;xs:schema</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="atn">xmlns:xs</span><span class="pun">=</span><span class="atv">'http://www.w3.org/2001/XMLSchema'</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="atn">xmlns:stream</span><span class="pun">=</span><span class="atv">'http://etherx.jabber.org/streams'</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="atn">targetNamespace</span><span class="pun">=</span><span class="atv">'http://jabber.org/protocol/httpbind'</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">'http://jabber.org/protocol/httpbind'</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="atn">elementFormDefault</span><span class="pun">=</span><span class="atv">'qualified'</span><span class="tag">&gt;</span><span class="pln"><br><br>&nbsp; </span><span class="tag">&lt;xs:annotation&gt;</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="tag">&lt;xs:documentation&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; The protocol documented by this schema is defined in<br>&nbsp; &nbsp; &nbsp; XEP-0124: http://www.xmpp.org/extensions/xep-0124.html<br>&nbsp; &nbsp; </span><span class="tag">&lt;/xs:documentation&gt;</span><span class="pln"><br>&nbsp; </span><span class="tag">&lt;/xs:annotation&gt;</span><span class="pln"><br><br>&nbsp; </span><span class="tag">&lt;xs:import</span><span class="pln"> </span><span class="atn">namespace</span><span class="pun">=</span><span class="atv">'http://www.w3.org/XML/1998/namespace'</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="atn">schemaLocation</span><span class="pun">=</span><span class="atv">'http://www.w3.org/2001/03/xml.xsd'</span><span class="tag">/&gt;</span><span class="pln"><br><br>&nbsp; </span><span class="tag">&lt;xs:element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'body'</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="tag">&lt;xs:complexType&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:choice&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'uri'</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">'0'</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="atn">maxOccurs</span><span class="pun">=</span><span class="atv">'1'</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:string'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:any</span><span class="pln"> </span><span class="atn">namespace</span><span class="pun">=</span><span class="atv">'##other'</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">'0'</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="atn">maxOccurs</span><span class="pun">=</span><span class="atv">'unbounded'</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="atn">processContents</span><span class="pun">=</span><span class="atv">'lax'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/xs:choice&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'accept'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:string'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'ack'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:positiveInteger'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'authid'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:string'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'charsets'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:NMTOKENS'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'condition'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:simpleType&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:restriction</span><span class="pln"> </span><span class="atn">base</span><span class="pun">=</span><span class="atv">'xs:NCName'</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'bad-request'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'host-gone'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'host-unknown'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'improper-addressing'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'internal-server-error'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'item-not-found'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'other-request'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'policy-violation'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'remote-connection-failed'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'remote-stream-error'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'see-other-uri'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'system-shutdown'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'undefined-condition'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/xs:restriction&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/xs:simpleType&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/xs:attribute&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'content'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:string'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'from'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:string'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'hold'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:unsignedByte'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'inactivity'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:unsignedShort'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'key'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:string'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'maxpause'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:unsignedShort'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'newkey'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:string'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'pause'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:unsignedShort'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'polling'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:unsignedShort'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'report'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:positiveInteger'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'requests'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:unsignedByte'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'rid'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:positiveInteger'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'route'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:string'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'sid'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:string'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'stream'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:string'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'time'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:unsignedShort'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'to'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:string'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'type'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:simpleType&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:restriction</span><span class="pln"> </span><span class="atn">base</span><span class="pun">=</span><span class="atv">'xs:NCName'</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'error'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:enumeration</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">'terminate'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/xs:restriction&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/xs:simpleType&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/xs:attribute&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'ver'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:string'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">'wait'</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'xs:unsignedShort'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:attribute</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">'xml:lang'</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">'optional'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;xs:anyAttribute</span><span class="pln"> </span><span class="atn">namespace</span><span class="pun">=</span><span class="atv">'##other'</span><span class="pln"> </span><span class="atn">processContents</span><span class="pun">=</span><span class="atv">'lax'</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="tag">&lt;/xs:complexType&gt;</span><span class="pln"><br>&nbsp; </span><span class="tag">&lt;/xs:element&gt;</span><span class="pln"><br><br></span><span class="tag">&lt;/xs:schema&gt;</span><span class="pln"><br>&nbsp; &nbsp; </span></pre>
<h3>Mustache</h3>
<p>Mustache es un patrón utilizado para desarrollar plantillas para páginas webs. Empresas como LinkedIn o Twitter lo utilizan en sus webs para llevar a cabo la tarea de mostrar sus páginas en diferentes idiomas.</p> 
<p>Nosotros hemos usado Mustache también para la traducción de nuestro proyecto. Ha sido muy sencillo, ya que Candy ya utilizaba Mustache internamente y además la herramienta es realmente muy sencilla de usar. El resultado es simplemente genial: las páginas se diseñan con etiquetas en vez de textos y después los textos asignados a cada etiqueta van en objetos JSON aparte, de forma que se puede modular el código muy fácilmente y además se puede traducir de una forma muy limpia.</p>
<p>Las etiquetas en Mustache se definen {{etiqueta}} y luego se "traduce" pasándole a Mustache el nodo del DOM a renderizar y el objeto JSON con las etiquetas. Es muy rápido y además permite crear patrones más elaborados que la simple traducción, aunque nosotros no los hemos necesitado.</p>
<h3>AJAX</h3>
<p>La tecnología AJAX (Asynchronous JavaScript and XML) es el corazón de Roomba. De hecho, no hay prácticamente contenido estático en toda la web, de modo que casi todo el contenido se carga y se muestra con JavaScript. Toda la información relativa a la comunicación dentro de una sala de chat se carga asíncronamente con eventos que provienen del servidor. Sin embargo, todo esto va recubierto de librerías que implementan el protocolo XMPP, el cual ya utiliza eventos y funciones escuchadoras que se basan en AJAX, de modo que el uso de esta tecnología en Roomba es básico e imprescindible.</p>
<h3>Openfire</h3>
<p>Openfire es un servidor de XMPP escrito en Java. Es de código libre con licencia Apache, buena cosa porque <strong>hemos tenido que tocar su código fuente</strong> para poder adaptarlo a ciertas necesidades que teníamos y que no se veían contempladas en su configuración. En nuestro caso, nuestro Openfire modificado está corriendo en una máquina con Linux sin ningún problema, aunque el hecho de estar escrito en Java hace que requiera mucha memoria y dado que la máquina no es muy potente, hay que reiniciar el servicio cada pocas semanas.</p>
<p>Openfire utiliza una base de datos en MySQL, aunque no almacena las conversaciones sino que las mantiene en memoria. Las modificaciones que hemos hecho van orientadas a la creación automática de salas sin permiso, de forma que se pueda crear una sala sin necesidad de pasar por un administrador. Esto puede acarrear problemas de flooding, pero siendo un proyecto pequeño de momento no nos preocupa.</p>
<p>El servicio abre una serie de puertos para sus comunicaciones y el 9090/9091 para su configuración web. Se requiere a un administrador para cambiar su configuración y lo tenemos montado de tal forma que sólo admita comunicaciones http-bind por el puerto 7070. Este puerto no es accesible desde el exterior, pero sí desde un proxy montado en la máquina, de forma que Roomba puede hacer uso de Openfire pero nadie más; si un atacante quisiera entrar en la máquina a través de Openfire primero tendría que encontrar la forma de hackear Candy o Apache.</p>
<h3>Apache</h3>
<p>La elección de servidor web por nuestra parte ha sido Apache, por su fácil instalación bajo entornos Linux y su versatilidad a la hora de configurar. En nuestro caso hemos ido más allá de una instalación básica de Apache: hemos utilizado módulos específicos para conseguir darle esas pinceladas de sencillez y robustez que buscábamos.</p>
<p>El caso del mod_proxy sirve para acceder al puerto 7070 (http-bind de Openfire) de forma interna a través de Candy, única y exclusivamente, de modo que el puerto se muestra cerrado para cualquier otro usuario que intente acceder a él.</p>
<p>Otro módulo usado es el mod_rewrite, para poder crear URLs más limpias y agradables al uso. Así conseguimos que cualquier URL de Roomba sea del tipo http://eroomba.com/idioma/chatID, mucho más agradable que la traducción real que sería http://eroomba.com?id=chatID&lang=idioma</p>
<h3>Cookies y sesiones</h3>
<p>Este apartado se divide en dos partes:</p>
<h4>Cookies para Roomba</h4>
<p>Roomba utiliza cookies para almacenar única y exclusivamente el nick del usuario, de forma que una vez introducido el nick sólo haya que entrar en un chat para empezar a intercambiar mensajes, lo cual es el punto fuerte y diferenciador de nuestra aplicación. La cookie puede ser borrada usando el link de salir | cambiar nick, tras lo cual la aplicación pide un nombre de usuario al no localizar la cookie.</p>
<h4>Sesiones para Openfire</h4>
<p>El servidor Openfire utiliza cookies también, pero de forma interna. Utiliza un sistema de sesiones almacenadas en la base de datos, de forma que se almacena en el navegador del usuario un string aleatorio que se compara con el almacenado en la base de datos del servidor. De esta forma un administrador de Openfire sólo se autentica una vez y gracias a este sistema su sesión se mantiene, garantizando así que las URLs internas del sistema de configuración no son accesibles excepto para alguien que tenga una cookie con una sesión validada en el servidor, esto es, un usuario previamente autenticado con contraseña.</p>
</div> 
      
	 <!--#include virtual="foot_es.html" -->

   </body>
</html>
